#!/bin/sh

continuous() {
while true;
do
    usage=$(awk '{u=$2+$4; t=$2+$4+$5; if (NR==1){u1=u; t1=t;} else print ($2+$4-u1) * 100 / (t-t1) "%"; }' <(grep 'cpu ' /proc/stat) <(sleep 1;grep 'cpu ' /proc/stat))
    echo "Cpu name: $(lscpu | grep 'Model name:' | cut -c34-)"
    echo "Temp: $(sensors | grep "Tctl:" | awk '{print $2}')"
    echo "All core mhz: $(lscpu | grep 'CPU MHz' | awk '{print $3}') mhz"
    echo "Cpu usage: $usage"
    i=$((0))
    echo
    for cpu in /sys/devices/system/cpu/cpu?
    do
        freq=$(< $cpu/cpufreq/scaling_cur_freq)
        hz=$(echo "scale=3; $freq / 1000" | bc)
        echo "cpu$i: $(< $cpu/cpufreq/scaling_governor) $(echo "scale=4; $freq / 1000" | bc) mhz"
        i=$(($i + 1))
    done
    sleep 4
done
}

print() {
usage=$(awk '{u=$2+$4; t=$2+$4+$5; if (NR==1){u1=u; t1=t;} else print ($2+$4-u1) * 100 / (t-t1) "%"; }' <(grep 'cpu ' /proc/stat) <(sleep 1;grep 'cpu ' /proc/stat))
echo "Cpu name: $(lscpu | grep 'Model name:' | cut -c34-)"
echo "Temp: $(sensors | grep "Tctl:" | awk '{print $2}')"
echo "All core mhz: $(lscpu | grep 'CPU MHz' | awk '{print $3}') mhz"
echo "Cpu usage: $usage"
i=$((0))
echo
for cpu in /sys/devices/system/cpu/cpu?
do
    freq=$(< $cpu/cpufreq/scaling_cur_freq)
    hz=$(echo "scale=3; $freq / 1000" | bc)
    echo "cpu$i: $(< $cpu/cpufreq/scaling_governor) $(echo "scale=4; $freq / 1000" | bc) mhz"
    i=$(($i + 1))
done
}

if [[ $1 == "-c" ]]; then
    continuous
else
    print
fi
